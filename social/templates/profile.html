{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if profile.full_name %} {{profile.full_name}} {% else %} {{user.username}} {% endif %}</title>
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* Base and Utility Styles */
        :root {
            /* Define colors based on your Tailwind config */
            --primary-blue: #3897f0;
            --secondary-gray: #dbdbdb;
            --text-gray-900: #1f2937; /* Equivalent of Tailwind's gray-900 */
            --text-gray-800: #374151; /* Equivalent of Tailwind's gray-800 */
            --text-gray-700: #4b5563; /* Equivalent of Tailwind's gray-700 */
            --text-gray-600: #4b5563; /* Equivalent of Tailwind's gray-600 */
            --text-gray-500: #6b7280; /* Equivalent of Tailwind's gray-500 */
            --bg-light: #f7f7f7; /* Your custom body background */
            --border-gray-200: #e5e7eb; /* Equivalent of Tailwind's gray-200 */
            --bg-gray-100: #f3f4f6;
            --bg-green-100: #d1fae5;
            --text-green-700: #047857;
            --border-green-200: #a7f3d0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            /* Equivalent of pt-14 and pb-14 */
            padding-top: 56px;
            padding-bottom: 56px;
            margin: 0;
            line-height: 1.5;
        }

        /* Container for Main Content (max-w-xl mx-auto p-4) */
        .main-content {
            max-width: 640px; /* max-w-xl */
            margin-left: auto;
            margin-right: auto;
            padding: 1rem; /* p-4 */
            padding-top: 2rem; /* pt-8 to visually match the original */
        }

        /* Profile Picture Styling */
        .profile-pic-lg {
            width: 96px; /* w-24 */
            height: 96px; /* h-24 */
            border-radius: 50%; /* rounded-full */
            object-fit: cover;
            border: 2px solid #fff;
            box-shadow: 0 0 0 2px var(--border-gray-200);
            flex-shrink: 0; /* flex-shrink-0 */
            margin-right: 1.5rem; /* mr-6 */
        }

        /* Info Label Styling */
        .info-label {
            font-size: 0.875rem; /* text-sm */
            font-weight: 600; /* font-semibold */
            color: var(--text-gray-500);
        }

        /* Post Grid Item Styling */
        .post-grid-item-container {
            position: relative;
            aspect-ratio: 1 / 1; /* Ensures posts are square */
            cursor: pointer;
        }
        .post-grid-item {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .post-grid-no-image {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #d1d5db; /* gray-300 */
            color: var(--text-gray-600);
            font-size: 0.75rem; /* text-xs */
            padding: 0.5rem; /* p-2 */
        }

        /* Hover Overlay for Posts */
        .post-overlay {
            position: absolute;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: opacity 150ms ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem; /* space-x-4 */
            color: white;
            cursor: pointer;
        }

        .post-grid-item-container:hover .post-overlay {
            opacity: 1;
        }

        .post-overlay span {
            display: flex;
            align-items: center;
            font-weight: 700; /* font-bold */
            font-size: 1.125rem; /* text-lg */
        }
        .post-overlay span i {
            margin-right: 0.25rem; /* mr-1 */
        }

        /* --- Header Styling --- */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 56px; /* h-14 */
            background-color: white;
            border-bottom: 1px solid var(--border-gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-left: 1rem; /* px-4 */
            padding-right: 1rem; /* px-4 */
            z-index: 20;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
        }
        .header h1 {
            font-size: 1.25rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            color: var(--text-gray-800);
        }
        .header-icon {
            font-size: 1.25rem; /* text-xl */
            color: var(--text-gray-700);
            cursor: pointer;
            transition: color 150ms;
        }
        .header-icon:hover {
            color: var(--text-gray-900);
        }
        .header-actions {
            display: flex;
            gap: 1rem; /* space-x-4 */
        }

        /* --- Messages/Alerts --- */
        .alert-message {
            padding: 0.75rem; /* p-3 */
            background-color: var(--bg-green-100);
            color: var(--text-green-700);
            border: 1px solid var(--border-green-200);
            border-radius: 0.5rem; /* rounded-lg */
            margin-bottom: 1rem; /* mb-4 */
        }
        .alert-message p {
            font-size: 0.875rem; /* text-sm */
        }

        /* --- Profile Summary Section --- */
        .profile-summary {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem; /* mb-6 */
        }
        .stats-container {
            display: flex;
            flex: 1; /* flex-1 */
            justify-content: space-around;
            text-align: center;
        }
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .stat-item span:first-child {
            font-size: 1.25rem; /* text-xl */
            font-weight: 700; /* font-bold */
            color: var(--text-gray-900);
        }
        .stat-item span:last-child {
            font-size: 0.875rem; /* text-sm */
            color: var(--text-gray-500);
        }

        /* --- Bio and Details --- */
        .profile-details {
            margin-bottom: 1.5rem; /* mb-6 */
        }
        .profile-details h3 {
            font-size: 1.125rem; /* text-lg */
            font-weight: 700; /* font-bold */
            color: var(--text-gray-800);
        }
        .profile-details p {
            color: var(--text-gray-700);
            margin-top: 0.25rem; /* mt-1 */
        }
        .secondary-details {
            display: flex;
            gap: 1rem; /* space-x-4 */
            margin-top: 0.5rem; /* mt-2 */
            font-size: 0.875rem; /* text-sm */
            color: var(--text-gray-500);
        }
        .secondary-details span {
            display: flex;
            align-items: center;
        }
        .secondary-details span i {
            margin-right: 0.25rem; /* mr-1 */
        }
        .contact-details {
            margin-top: 0.75rem; /* mt-3 */
            padding-top: 0.75rem; /* pt-3 */
            border-top: 1px solid #f3f4f6; /* border-gray-100 */
            font-size: 0.875rem; /* text-sm */
            color: var(--text-gray-600);
        }
        .contact-details > div {
            margin-bottom: 0.25rem; /* space-y-1 */
        }
        .contact-details .info-label span {
            color: var(--text-gray-800);
            font-weight: 400; /* font-normal */
        }

        /* --- Action Buttons --- */
        .action-buttons {
            display: flex;
            gap: 0.5rem; /* space-x-2 */
            margin-bottom: 2rem; /* mb-8 */
        }

        .action-button {
            flex: 1; /* flex-1 */
            text-align: center;
            padding-top: 0.5rem; /* py-2 */
            padding-bottom: 0.5rem; /* py-2 */
            font-weight: 600; /* font-semibold */
            border-radius: 0.5rem; /* rounded-lg */
            transition: background-color 150ms ease-in-out;
            cursor: pointer;
            text-decoration: none; /* For <a> tags */
            border: none;
        }

        /* Secondary Button Style (Edit Profile, Following, Message, Settings) */
        .btn-secondary {
            background-color: var(--secondary-gray);
            color: var(--text-gray-900);
        }
        .btn-secondary:hover {
            background-color: #d1d5db; /* Equivalent of gray-300 */
        }
        /* Primary Button Style (Follow) */
        .btn-primary {
            background-color: var(--primary-blue);
            color: white;
        }
        .btn-primary:hover {
            background-color: #2579ce; /* Equivalent of blue-600 */
        }
        /* Specific width for the gear button */
        .action-buttons .btn-gear {
            width: 25%; /* w-1/4 */
            flex: none; /* Override flex-1 */
        }
        .action-buttons form {
            flex: 1; /* Make forms take full space */
        }
        .action-buttons form button {
            width: 100%;
        }

        /* --- Post Grid/Tab Navigation --- */
        .grid-tab-nav {
            border-top: 1px solid var(--border-gray-200);
        }
        .grid-tab-icon-container {
            display: flex;
            justify-content: center;
            color: var(--text-gray-500);
            padding-top: 0.75rem; /* py-3 */
            padding-bottom: 0.75rem; /* py-3 */
            border-top: 2px solid var(--primary-blue);
            margin-left: auto; /* mx-auto */
            margin-right: auto; /* mx-auto */
            width: 25%; /* w-1/4 */
        }
        .grid-tab-icon-container i {
            font-size: 1.25rem; /* text-xl */
            color: var(--primary-blue);
        }

        /* --- Posts Grid --- */
        .posts-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* grid-cols-3 */
            gap: 2px; /* gap-0.5 is 2px in default config */
            /* Negative margin to counteract grid gap outside on mobile views */
            margin-left: -1rem; /* -mx-4 */
            margin-right: -1rem; /* -mx-4 */
        }
        @media (min-width: 640px) { /* sm:mx-0 */
            .posts-grid {
                margin-left: 0;
                margin-right: 0;
            }
        }

        /* No Posts Message */
        .no-posts-message {
            text-align: center;
            padding: 2.5rem; /* p-10 */
            background-color: white;
            border-radius: 0.75rem; /* rounded-xl */
            margin-top: 1.5rem; /* mt-6 */
            border: 1px solid var(--border-gray-200);
        }
        .no-posts-message h3 {
            font-size: 1.25rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            color: var(--text-gray-600);
        }
        .no-posts-message p {
            color: var(--text-gray-500);
            margin-top: 0.5rem; /* mt-2 */
        }

        /* --- Bottom Navigation --- */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 56px; /* h-14 */
            background-color: white;
            border-top: 1px solid var(--border-gray-200);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 20;
            box-shadow: 0 -1px 3px 0 rgba(0, 0, 0, 0.1), 0 -1px 2px -1px rgba(0, 0, 0, 0.06); /* shadow-lg */
        }

        .nav-icon {
            color: var(--text-gray-700);
            transition: color 150ms ease-in-out;
            text-decoration: none;
        }

        .nav-icon:hover {
            color: #3b82f6; /* A slightly darker blue for hover, like blue-600 */
        }

        .nav-icon i {
            font-size: 1.5rem; /* text-2xl */
        }

        .nav-icon-active {
            color: var(--primary-blue);
        }

        .nav-icon-post i {
            font-size: 1.875rem; /* text-3xl */
            color: var(--primary-blue);
        }
        .nav-icon-post:hover {
            color: #2579ce; /* Equivalent of blue-800 */
        }

    </style>
</head>
<body>

<header class="header">
    <a href="/" class="header-icon"><i class="fa-solid fa-arrow-left"></i></a>
    <h1>{{user.username}}</h1>
    <div class="header-actions">
        <i class="fa-solid fa-gear header-icon"></i>
    </div>
</header>

<main class="main-content">

    {% if messages %}
    <div class="alert-message">
        {% for message in messages %}
        <p>{{message}}</p>
        {% endfor %}
    </div>
    {% endif %}

    <div class="profile-summary">
        <div class="profile-pic-container">
           <a href="{{user.profile.picture.url}}"> <img src="{{user.profile.picture.url}}" alt="{{user.username}}" class="profile-pic-lg"></a>
        </div>

        <div class="stats-container">
            <div class="stat-item">
                <span>{{posts|length}}</span>
                <span>Posts</span>
            </div>
            <div class="stat-item">
                <span>{{profile.followers.count}}</span>
                <span>Followers</span>
            </div>
            <div class="stat-item">
                <span>{{user.profile.followings.count}}</span>
                <span>Following</span>
            </div>
        </div>
    </div>

    <div class="profile-details">
        <h3>{{user.first_name}} {{user.last_name}}</h3>
        {% if profile.bio %}
        <p>{{profile.bio}}</p>
        {% endif %}
        <div class="info-label"><i style="margin-right: 7px;" class="far fa-clock"></i>Joined {{profile.created_at |date:"F Y"}}</div>
        {% if profile.location or profile.address %}
            <div class="contact-details">
             <div class="info-label">{% if profile.location %}<span class="location-detail"><i class="fas fa-map-marker-alt"></i> {{profile.location}}</span>{% endif %}</div>
             <div class="info-label">{% if profile.address %}<span class="address-detail"><i class="fa-solid fa-location-dot"></i> {{profile.address}}</span>{% endif %}</div>
            </div>
        {% endif %}
        <div class="contact-details">
            <div class="info-label"><i  class="fas fa-envelope"></i> <span>{{user.email}}</span> 
                {% if user.profile.phone %}<i style="margin-left: 10px;" class="fas fa-phone"></i> <span>{{user.profile.phone}}</span>{% endif %}
            </div>
             
        </div>
    </div>

    <div class="action-buttons">
        {% if request.user == user %}
        <a href="{% url 'update_profile' user.username %}" class="action-button btn-secondary">
            Edit Profile
        </a>
        <button class="action-button btn-secondary btn-gear">
            <i class="fa-solid fa-user-gear"></i>
        </button>
        {% else %}
        {% if request.user in profile.followers.all %}
            <form action="{% url 'follow' user.username %}" method="post">
                {% csrf_token %}
                <button type="submit" class="action-button btn-secondary">
                    Following
                </button>
            </form>
        {% else %}
            <form action="{% url 'follow' user.username %}" method="post">
                {% csrf_token %}
                <button type="submit" class="action-button btn-primary">
                    Follow
                </button>
            </form>
        {% endif %}
        <a href="{% url 'message' user.username %}" class="action-button btn-secondary">
            Message
        </a>
        {% endif %}
    </div>

    <div class="grid-tab-nav">
        <div class="grid-tab-icon-container">
            <i class="fa-solid fa-table-cells"></i>
        </div>
    </div>

    {% if posts %}
    <div class="posts-grid">
        {% for post in posts %}
            {% if post.images.all %}
            {% comment %} Only display the first image in the grid for the preview {% endcomment %}
            {% with first_image=post.images.all|first %}
                <a href="{% url 'post_comment' post.post_id %}"><div class="post-grid-item-container">
                    {% if first_image %}
                        <img src="{{first_image.image.url}}" alt="Post" class="post-grid-item">
                    {% else %}
                        <div class="post-grid-no-image">
                            No Image
                        </div>
                    {% endif %} 
                    <div class="post-overlay">
                        <span><i class="fa-solid fa-heart"></i> {{post.likes.count}}</span>
                        <span><i class="fa-solid fa-comment"></i> {{post.comments.count}}</span>
                    </div>
                </div> </a>
            {% endwith %}

            {% endif %}
        {% endfor %}
    </div>
    {% else %}
    <div class="no-posts-message">
        <h3>No Posts Yet</h3>
        <p>This user hasn't shared any posts.</p>
    </div>
    {% endif %}

</main>

<nav class="bottom-nav">
    <a href="/" class="nav-icon">
        <i class="fa-solid fa-home"></i>
    </a>
    <a href="#" class="nav-icon">
        <i class="fa-solid fa-search"></i>
    </a>
    <a href="#" class="nav-icon nav-icon-post">
        <i class="fa-solid fa-plus-circle"></i>
    </a>
    <a href="#" class="nav-icon">
        <i class="fa-solid fa-bell"></i>
    </a>
    <a href="{% url 'profile' user.username %}" class="nav-icon nav-icon-active">
        <i class="fa-solid fa-user-circle"></i>
    </a>
</nav>

{% include 'footer.html' %}
</body>
</html>